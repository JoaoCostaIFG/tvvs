# Assignment 1 - G03P02

## Group information

- Ana Inês Oliveira de Barros - `up201806593@fe.up.pt`;
- João de Jesus Costa - `up201806560@fe.up.pt`

## Project description

The project is a time tracking tool that allows users to track their daily tasks
and the time invested in each of them. With this app, users obtain a record of
their activities and work time.

### Project structure

- The project is organized in 4 packages;
- The main function resides in the `JTimeSchedApp.java` file (in the root package);
- Most of the code logic resides in the `Project` class (in the project package).

```none
de.dominik_geyer.jtimesched            - root package
|-- JTimeSchedApp.java                 - location of main function
|-- gui                                - gui related code
|   |-- ColorDialog.java
|   |-- JTimeSchedFrame.java
|   |-- NotesDialog.java
|    -- table
|       |-- CheckCellRenderer.java
|       |-- ColorCellEditor.java
|       |-- ColorCellRenderer.java
|       |-- CustomCellRenderer.java      
|       |-- DateCellEditor.java
|       |-- ProjectTable.java
|       |-- TimeCellComponent.java
|       |-- TimeCellEditor.java
|        -- TimeCellRenderer.java
|-- misc
|    -- PlainTextFormatter.java
 -- project                            - task related code
    |-- Project.java                   - where most code logic resides
    |-- ProjectException.java
    |-- ProjectSerializer.java
    |-- ProjectTableModel.java
     -- ProjectTime.java
```

## Static testing

Static testing is one of the testing techniques for checking faults in software.
The main advantage of static code analysis is the fact that it is performed without
executing the code, thus being more lightweight than other types of testing. For
this reason, it is usually employed before executing the rest of the software's
test suite.

Static test tools are able to detect faults prior to the execution of other tests,
and warm about _suspicious_ aspects of the code. Another aspect that these tools
help with is code maintainability/design by allowing to enforce a certain code style.

## [Checkstyle tool](https://checkstyle.sourceforge.io/)

The Checkstyle tool makes it ideal for projects that want to enforce a coding standard. 
It can find class design problems, method design problems. It also has the ability to 
check code layout and formatting issues.

### Configuration

The Checkstyle plugin has a default rule set that indicates what issues the tool should 
look for. These rules are contained in `rulesets/checkstyle-rules.xml`. The rules were
adapted to reduce the amount irrelevant issues. These changes are listed below. 

1. Indentation

The default configuration considers indentation using tabs as a warning. Since we are
working with a fork of an open source project, we decided that the best option was to
conform to the indentation style of the author of the code.
Many lines of code were indented using tabs, so we adapted the rule set to accept this indentation.
Another issue was that _switch cases_ were not indented, so we had to set its indentation value to 0. 

Before:
```xml
<module name="Indentation">
      <property name="basicOffset" value="2"/>
      <property name="braceAdjustment" value="2"/>
      <property name="caseIndent" value="2"/>
      <property name="throwsIndent" value="4"/>
      <property name="lineWrappingIndentation" value="4"/>
      <property name="arrayInitIndent" value="2"/>
</module>
```

After:
```xml
 <module name="Indentation">
      <property name="basicOffset" value="8"/>
      <property name="braceAdjustment" value="8"/>
      <property name="caseIndent" value="0"/>
      <property name="throwsIndent" value="16"/>
      <property name="lineWrappingIndentation" value="16"/>
      <property name="arrayInitIndent" value="8"/>
 </module>
```

2. Underscore in package name

There were also a lot of warnings related to the package name. In the default 
configuration package names are checked against a specific REGEX which does not
allow the '_' character. Since we considered this error irrelevant, we changed
the rule to accept the `de.dominik_geyer.jtimesched` package name.

Before: `^[a-z]+(\.[a-z][a-z0-9]*)*$`
After: `^[a-z]+(\.[a-z][_a-z0-9]*)*$`

3. Import declaration groups

The tool was indicating that there was an issue regarding the groups of declaration of imports.
For example, an import from a `java` package shouldn't be separated from a `javax` import. Since
the author of the project organised the import declarations by grouping third party packages 
separately from the java standard ones, we adapted this rule to accept this separation.

Before: `<property name="customImportOrderRules" value="STATIC###THIRD_PARTY_PACKAGE"/>`

After: `<property name="customImportOrderRules" value="STATIC###STANDARD_JAVA_PACKAGE###THIRD_PARTY_PACKAGE"/>`

Since there is no information about the author's preference regarding the grouping of static imports
we left the default rule as it is (to separate the group of static import declarations).

4. If statement braces

Another irrelevant issues were caused by `if` statements missing braces. The ruleset was updated to 
ignore these by removing the *NeedBraces* rule.

``

### Problems & Fixes

#### Method indentation level

**Warning:** *'method def lcurly' has incorrect indentation level 8, expected level should be 16.*

**Warning:** *'method def rcurly' has incorrect indentation level 8, expected level should be 16.*

**Location:** file `JTimeSchedApp.java`, lines 100, 389, and 401.

Before fix:
```java
     * @return String The application's version; if not set in Manifest or not available it returns the string "unknown"
     */
    public static String getAppVersion()
    {
        String appVersion = Package.getPackage("de.dominik_geyer.jtimesched").getImplementationVersion();
        return (appVersion != null) ? appVersion : "unknown";
```

After fix:
```java
     * @return String The application's version; if not set in Manifest or not available it returns the string "unknown"
     */
    public static String getAppVersion() {
        String appVersion = Package.getPackage("de.dominik_geyer.jtimesched").getImplementationVersion();
        return (appVersion != null) ? appVersion : "unknown";
```

#### Indentation tabs & spaces

**Warning:** *'method def' child has incorrect indentation level 8, expected level should be 16.*

**Location:** file `JTimeSchedFrame.java`, lines 136, 709, 712, 714, and 715.

Before fix:

`<TAB><SPC><SPC><SPC><SPC><TAB>JTimeSchedApp.getLogger().warning("Unable to create backup of project file: " + e.getMessage());`

After fix:

`<TAB><TAB><TAB>JTimeSchedApp.getLogger().warning("Unable to create backup of project file: " + e.getMessage());`

#### Brace location

**Warning:** *'{' at column 3 should be on the previous line.*

**Location:** file `ProjectSerializer.java` line 81.

Before fix:

```java
  for (Project p: projects)
        {
```

After fix:

```java
   for (Project p: projects) {
```

#### Indentation level in for loop

**Warning:** *'for' child has incorrect indentation level 18, expected level should be one of the following: 24, 32.*

**Location:** file `ProjectSerializer.java` lines 82, 84, 85, and 86.

Before fix:

```java
        for (Project p: projects) {
          startXmlElement(hd, "project", null);

          addXmlElement(hd, "title", null, p.getTitle());
          addXmlElement(hd, "notes", null, p.getNotes());
```

After fix:

```java
        for (Project p: projects) {
            startXmlElement(hd, "project", null);

            addXmlElement(hd, "title", null, p.getTitle());
            addXmlElement(hd, "notes", null, p.getNotes());
```

#### Method call indentation level 

**Warning:** *'.' has incorrect indentation level 40, expected level should be 48.*

**Location:** file `CustomCellRenderer.java` lines 71-76

Before fix:

```java
    if (!prj.getNotes().isEmpty()) {
        String tooltip = prj.getNotes()
            .replaceAll("&", "&amp;")
            .replaceAll("(\r\n|\n)", "<br/>")
            .replaceAll(" ", "&nbsp;")
            .replaceAll("\t", "&nbsp;&nbsp;&nbsp;&nbsp;");
```

After fix:

```java
    if (!prj.getNotes().isEmpty()) {
        String tooltip = prj.getNotes()
                .replaceAll("&", "&amp;")
                .replaceAll("(\r\n|\n)", "<br/>")
                .replaceAll(" ", "&nbsp;")
                .replaceAll("\t", "&nbsp;&nbsp;&nbsp;&nbsp;");
```

#### For loop indentation level 2

**Warning:** *'for' child has incorrect indentation level 18, expected level should be one of the following: 24, 32.*

**Location:** file `ProjectSerializer.java` lines 82, 84, 85, and 86.

Before fix:

```java
    for (Project p: projects) {
      startXmlElement(hd, "project", null);
      
      addXmlElement(hd, "title", null, p.getTitle());
      addXmlElement(hd, "notes", null, p.getNotes());
```

After fix:

```java
        for (Project p: projects) {
            startXmlElement(hd, "project", null);

            addXmlElement(hd, "title", null, p.getTitle());
            addXmlElement(hd, "notes", null, p.getNotes());
```

### Results

Number of issues reported by the Checkstyle tool:
- Default Ruleset: 4194
- Before fixes (new ruleset/config): 327
- After fixes: 263